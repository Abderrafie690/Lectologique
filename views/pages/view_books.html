<?php
session_start();
require '../includes/db.php';

if (!isset($_SESSION['user_id'])) {
    header("Location: ../login.php");
    exit;
}

$user_id = $_SESSION['user_id'];
$sql = "SELECT * FROM bookss WHERE user_id = ?";
$stmt = $pdo->prepare($sql);
$stmt->execute([$user_id]);
$books = $stmt->fetchAll();
?>

<div class="container py-5">
  <h1 class="mb-4 text-center">ðŸ“š Mes livres</h1>

  <?php if (count($books) > 0): ?>
    <div class="row g-4">
      <?php foreach ($books as $book): ?>
        <div class="col-md-4">
          <div class="card h-100 shadow-sm">
            <?php if (!empty($book['cover_path'])): ?>
              <img src="<?= htmlspecialchars($book['cover_path']) ?>" class="card-img-top" style="height: 300px; object-fit: cover;" alt="Couverture">
            <?php endif; ?>
            <div class="card-body d-flex flex-column">
              <h5 class="card-title"><?= htmlspecialchars($book['title']) ?></h5>
              <p class="card-text text-muted small">AjoutÃ© le <?= date('d/m/Y', strtotime($book['created_at'])) ?></p>
              <div class="mt-auto d-flex justify-content-between">
                <a href="/edit-book?id=<?= $book['id'] ?>" data-link class="btn btn-outline-primary btn-sm"><i class="bi bi-pencil"></i> Modifier</a>
                <a href="/delete-book?id=<?= $book['id'] ?>" class="btn btn-outline-danger btn-sm" onclick="return confirm('Supprimer ce livre ?')"><i class="bi bi-trash"></i> Supprimer</a>
              </div>
            </div>
          </div>
        </div>
      <?php endforeach; ?>
    </div>
  <?php else: ?>
    <p class="text-muted text-center">Aucun livre trouvÃ©. Commencez par en ajouter un !</p>
  <?php endif; ?>
</div>
